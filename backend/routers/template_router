import os
import requests
from fastapi import APIRouter, HTTPException, Request
from fastapi.middleware.cors import CORSMiddleware

router = APIRouter(tags=["templates"])

#@router.post("/templates")
@router.post("/create-template")
async def create_template(req: Request):
    payload = await req.json()
    api_key = "Bearer skI7lyZ0g0qj4dHDvwJ5k"
    #channel = payload.pop("channel", os.getenv("CHANNEL_NUMBER", "917996666220"))
    channel = "917996666220"
    url = f"https://cloudapi.wbbox.in/api/v1.0/create-templates/{channel}"
    headers = {
        "Authorization": f"Bearer {api_key}",
        "Content-Type": "application/json",
    }
    try:
        response = requests.post(url, json=payload, headers=headers)
        response.raise_for_status()
    except requests.HTTPError as e:
        raise HTTPException(status_code=response.status_code, detail=response.text)
    #return response.json()
    return "success"